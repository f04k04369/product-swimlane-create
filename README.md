# Swimlane Studio

Next.js + TypeScript 製のスイムレーン図エディタです。ドラッグ＆ドロップで業務フローを可視化し、Mermaid記法の`.md`ファイルやPNG画像として書き出せます。監査ログのダウンロードにも対応しています。

## セットアップ

```bash
npm install
npm run dev
```

ブラウザで `http://localhost:3000` を開くとエディタが利用できます。

### テスト

Vitest + Testing Library を導入しています。

```bash
npm run test
```

JSDOM 上で状態管理とMermaidエクスポートのラウンドトリップを検証する基本テストが実行されます。

### E2E テスト

Playwright で実ブラウザ操作を自動化できます。`npm run dev` を別途起動する必要はなく、テスト実行時に自動で立ち上がります。

```bash
npm run test:e2e
```

主要なE2Eテストが起動し、レーン追加やMermaidモーダル表示などの基本フローを検証します。

## 主な機能

- 縦型カラムのレーン／ステップをドラッグ＆ドロップ編集、行単位で入れ替え
- 条件分岐（菱形）、開始／終了（ラウンド）など複数ステップ形状に対応
- ステップ種別の変更、上下入れ替えボタン、サイドバー編集（開閉可能）
- レーン内の連続ステップ間に自動で矢印コネクタを表示
- レーン一覧・ステップ詳細パネルでの属性編集（名称、説明、サイズ、色など）
- Mermaid記法の`.md`ファイル出力と再インポートによる復元
- PNG画像のエクスポート（高解像度）
- 操作履歴の監査ログ（JSON）ダウンロード
- Undo / Redo, レーン並び替え、ステップ削除

## Mermaid互換

エクスポートされる`.md`ファイルは以下の特徴を持ちます。

- `%% Swimlane Studio Export v1` のメタデータコメント付き
- レーン・ステップの属性や配置座標をJSONメタデータとして保持
- Mermaid対応ツールでレンダリング可能（flowchart LR ベース）
- 再インポートするとレーン構成・ステップ情報が復元されます

## 監査ログ

エディタ上の操作（レーン追加、ステップ更新、接続など）は監査ログとして保持されます。ツールバーの「監査ログ」ボタンからJSONファイルをダウンロードし、変更履歴の証跡として保管できます。
